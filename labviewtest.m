% ruta="C:\Users\super\OneDrive\upiita\animales\db\Leon\5.jpg";

w1=[-0.5304    2.3276    0.9034    0.9356   -0.9262   -1.0388    0.0628
   -4.0928    2.8445    2.3252    0.5260   -8.8886    2.5741   -2.0877
   -2.1765    3.2183   -0.1902   -4.6503    5.6832   -0.8617   -1.7207
    0.2131    2.4567    0.9829    1.1983   -0.2394   -0.1002    0.3760
   -0.4308    4.4336   -2.4031    8.1649    1.3435    2.3976   -2.1384
   -2.0904   -0.8845   -2.3458   -0.6656   -3.5916    2.3999   -1.3052
    2.6514    1.4509   -2.0686   -4.8774    0.5986    3.1549    1.8874
   -2.8529   -8.8114   -5.5074    2.5331    1.5245   -0.1764    4.8168
   -1.1012    2.5272    1.9551    1.4335   -1.1095    0.5394   -0.1632
   -0.8208   13.4832   -1.4293   -1.0392   -0.7440   -6.7461    0.1432
    4.8367   -1.1821    0.8768   -0.6312   -1.1911    1.9989   -1.9196
   -0.5460   -2.7971   -1.0234   -2.2464    0.6378    0.0299   -2.2697
   -0.4400   -1.7468   -0.5635    0.0952    0.8687   -0.4797    0.9218
    2.7854   -0.0325   -0.8608   -3.5820   -2.5353   -3.3573    3.6621
   -2.3652   -0.5768    0.0274   -3.5648   -0.5802    0.5112   -2.1561
   -3.3966  -12.5280   -9.6257    2.1797    1.9754   -1.4321    4.9323
    4.4256   -3.7555    0.2362   -2.7119   -2.1475    0.8037   -2.6494
    1.4064    1.9487    0.1727   -1.1681    1.2241   -0.7330    1.3459
   -1.7131    2.8812   -0.5097   -4.2284    2.8877   -1.3282   -0.0805
    0.1967    2.9432   -2.8587   -3.5873    3.1628   -0.8653    1.3047
    4.8008    1.1602   -0.5017    1.4019    1.1665    0.3224   -0.5624
   -1.7740    2.6834   -0.8416   -5.7293    4.4048   -0.4112   -0.1766
    0.3330    3.8168    1.2611    4.0852   -4.6614    1.6076    1.4385
    0.5835   -3.3738    1.9925   -0.0242    3.4536   -4.2563   -1.1237
   -0.6839    4.0355   -1.5589    0.3089   -2.9785    3.8071    1.0757
    ];
w21=[-2.3697   -1.9488   -1.6310
   -6.0900   -7.0619    8.1895
   -7.7716    6.8673    2.0667
   -2.6160   -2.1827    0.1590
    0.5670  -10.1663    9.0902
    5.6199    0.2271   -2.5010
   -0.6944    4.6710   -5.3115
    6.7874    0.4344   -7.6412
   -2.5485   -3.4064   -0.7938
  -11.6314   -2.2955   11.3595
    3.7287    0.6914   -4.3999
    3.1952    1.8551   -3.8676
    0.9728    0.9727   -1.4374
   -0.9539   -4.6761    8.7742
   -2.5596    2.9114   -3.5086
   11.3599    2.0202  -11.0505
    4.5030    3.6225   -4.1620
   -2.1508    1.4017   -1.8976
   -5.1149    2.7550   -1.7568
   -5.1637    1.8163   -4.6138
    2.5755   -0.4883   -4.0744
   -5.5636    3.7950   -5.7660
   -8.2175    5.2293    1.5818
    3.9716   -7.4481    2.5171
   -4.7849    6.3611   -2.8291
  ];
w2=w21';
b1=[-0.6572
    4.5885
   -3.9728
    0.0305
   -2.7412
   -1.4455
   -2.3460
   -2.8404
    0.1304
    6.3094
   -0.3005
    0.9076
   -1.7706
    1.4282
   -0.9734
   -4.0720
   -0.7786
   -0.7833
   -1.8994
   -0.6519
   -0.9731
   -2.7434
    1.5347
   -0.0125
    0.4471];
b2=[-0.7590
    0.2265
   -0.9018
    ];
mu=[0.0667
    0.0194
    0.9811
    0.6793
    0.0940
   15.4709
    0.5379];
sigma=[0.1061
    0.0247
    0.0237
    0.1435
    0.0732
    8.3950
    0.2413
    ];

I = imread(ruta);
Igray = rgb2gray(I);
Ibin = imbinarize(Igray);

Ihsv = rgb2hsv(I);
pixelsHSV = reshape(Ihsv(repmat(Ibin,[1 1 3])),[],3);

Hmean = mean(pixelsHSV(:,1));
Smean = mean(pixelsHSV(:,2));
Vmean = mean(pixelsHSV(:,3));

area = sum(Ibin(:));
areaNorm = area / numel(Ibin);

per = sum(bwperim(Ibin),'all');
perNorm = per / sqrt(area);

circularidad = 4*pi*area/(per^2);

stats = regionprops(Ibin,'Area','Eccentricity');
[~,idx] = max([stats.Area]);
ecc = stats(idx).Eccentricity;

Pt_test = [Hmean; Smean; Vmean; areaNorm; circularidad; perNorm; ecc];
Pt_test = (Pt_test - mu) ./ sigma;

a1 = logsig(w1*Pt_test + b1);
a2 = logsig(w2*a1 + b2);

[~,clase] = max(a2);
clase